networks:
  default:
    driver: bridge
    enable_ipv6: true
x-logging-policy: &logging-policy
  logging:
    driver: local
    options:
      max-size: "10m"
      max-file: "3"
      compress: "true"
services:
  gluetun-proxy:
    <<: *logging-policy
    image: qmcgaw/gluetun:${gluetun_version:-v3.40}
    container_name: gluetun-proxy
    restart: always
    cap_add:
      - NET_ADMIN
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=0
    environment:
      TZ: ${timezone:-UTC}
      VPN_SERVICE_PROVIDER: ${provider}
      VPN_TYPE: wireguard
      WIREGUARD_PRIVATE_KEY: ${wgkey}
      DOT_PROVIDERS: quad9
      SERVER_CITIES: ${cities:-Stockholm}
      HTTPPROXY_USER: ${proxy_user}
      HTTPPROXY_PASSWORD: ${proxy_pass}
    ports:
      - "1080:1080/tcp" # socks5 proxy
      - "8888:8888/tcp" # http proxy
    volumes:
      - ${data:-.}/gluetun-proxy:/gluetun:rw
  socks5proxy:
    <<: *logging-policy
    image: serjs/go-socks5-proxy:${socks5proxy_version:-latest}
    container_name: socks5proxy
    network_mode: service:gluetun-proxy
    restart: always
    environment:
      PROXY_USER: ${proxy_user}
      PROXY_PASS: ${proxy_pass}
  tor-privoxy:
    <<: *logging-policy
    image: dockage/tor-privoxy:${tor_privoxy_version:-latest}
    container_name: tor-privoxy
    restart: always
    ports:
      - "9050:9050/tcp"
