networks:
  default:
    driver: bridge
    enable_ipv6: false
x-common-settings: &common-settings
  logging:
    driver: local
    options:
      compress: "true"
      max-file: "3"
      max-size: "10m"
  restart: unless-stopped
  security_opt:
    - no-new-privileges:true
  stdin_open: false
  tty: false
services:
  gluetun_proxy:
    <<: *common-settings
    cap_drop:
      - ALL
    cap_add:
      - NET_ADMIN
      - NET_RAW
    container_name: gluetun_proxy
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      SERVER_CITIES: ${cities:-Stockholm}
      TZ: ${timezone:-UTC}
      VPN_SERVICE_PROVIDER: ${provider:?}
      VPN_TYPE: wireguard
      WIREGUARD_PRIVATE_KEY: ${wgkey:?}
    image: qmcgaw/gluetun:${gluetun_version:-v3.40}
    labels:
      kuma.__docker:
    ports:
      - "1080:1080/tcp"
    sysctls:
      - net.ipv6.conf.all.disable_ipv6=0
    volumes:
      - ${data:-.}/gluetun-proxy:/gluetun:rw
  socks5proxy:
    <<: *common-settings
    cap_drop:
      - ALL
    container_name: socks5proxy
    environment:
      PROXY_PASS: ${proxy_pass:?}
      PROXY_USER: ${proxy_user:?}
      REQUIRE_AUTH: ${enable_auth:-true}
    image: serjs/go-socks5-proxy:${socks5proxy_version:-latest}
    labels:
      kuma.__docker:
    network_mode: service:gluetun_proxy
